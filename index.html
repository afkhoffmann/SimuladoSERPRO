<!DOCTYPE html>
<html>
<head>
  <title>Simulado</title>
  <style>
    .question {
      margin-bottom: 10px;
    }
    .correct {
      color: green;
    }
    .incorrect {
      color: red;
    }
  </style>
</head>
<body>
  <h1>Simulado</h1>
  <div id="questions"></div>
  <button onclick="evaluateAnswers()">Enviar</button>

  <script>
    // Função para ler um arquivo CSV
    function parseCSV(csvContent) {
      const rows = csvContent.trim().split('\n');
      const headers = rows.shift().split(';');
      return rows.map(row => {
        const values = row.split(';');
        const entry = {};
        headers.forEach((header, index) => {
          entry[header] = values[index];
        });
        return entry;
      });
    }

    // Função para criar uma div de pergunta
    function createQuestionDiv(question, index) {
      const questionDiv = document.createElement('div');
      questionDiv.classList.add('question');
      questionDiv.innerHTML = `
        <h3>Pergunta ${index + 1}</h3>
        <p>${question.pergunta}</p>
        <label>
          <input type="radio" name="question-${index}" value="0"> ZERO
        </label>
        <label>
          <input type="radio" name="question-${index}" value="1"> UM
        </label>
      `;
      return questionDiv;
    }

    // Função para avaliar as respostas e exibir o resultado
    function evaluateAnswers() {
      const questions = document.querySelectorAll('.question');
      let correctCount = 0;

      questions.forEach((question, index) => {
        const selectedOption = question.querySelector(`input[name="question-${index}"]:checked`);
        const answer = parseInt(selectedOption.value);
        const isCorrect = (answer === parseInt(question.dataset.answer));
        if (isCorrect) {
          question.classList.add('correct');
          correctCount++;
        } else {
          question.classList.add('incorrect');
        }
      });

      const percentage = (correctCount / questions.length) * 100;
      alert(`Você acertou ${correctCount} de ${questions.length} (${percentage.toFixed(2)}%)`);
    }

    // Função principal para carregar os dados e criar as divs das perguntas
    function initializeSimulatedTest() {
      fetch('perguntas.csv')
        .then(response => response.text())
        .then(csvContent => {
          const questions = parseCSV(csvContent);
          fetch('temas.csv')
            .then(response => response.text())
            .then(csvContent => {
              const themes = parseCSV(csvContent);
              const questionsDiv = document.getElementById('questions');

              themes.forEach(theme => {
                const themeDiv = document.createElement('div');
                themeDiv.innerHTML = `<h2>${theme.descricao}</h2>`;
                questionsDiv.appendChild(themeDiv);

                const themeQuestions = questions.filter(question => question.tema === theme.tema);
                themeQuestions.forEach((question, index) => {
                  const questionDiv = createQuestionDiv(question, index);
                  questionDiv.dataset.answer = question.resposta;
                  themeDiv.appendChild(questionDiv);
                });
              });
            });
        });
    }

    // Chamada da função principal ao carregar a página
    document.addEventListener('DOMContentLoaded', initializeSimulatedTest);
  </script>
</body>
</html>
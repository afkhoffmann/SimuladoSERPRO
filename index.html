<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Simulado</title>
    <style>
        .question {
            margin-bottom: 10px;
        }

        .correct {
            color: green;
        }

        .incorrect {
            color: red;
        }
    </style>
</head>
<body>
    <h1>Simulado</h1>

    <div id="temas"></div>

    <button onclick="avaliarRespostas()">Enviar</button>

    <script>
        // Função para ler o arquivo CSV
        function lerArquivoCSV(nomeArquivo, callback) {
            const xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function() {
                if (this.readyState === 4 && this.status === 200) {
                    callback(this.responseText);
                }
            };
            xhttp.open("GET", nomeArquivo, true);
            xhttp.send();
        }

        // Função para processar os temas e perguntas
        function processarDados(temasData, perguntasData) {
            const temasDiv = document.getElementById("temas");
            const temas = parseCSV(temasData);
            const perguntas = parseCSV(perguntasData);

            temas.forEach(function(tema) {
                const temaDiv = document.createElement("div");
                temaDiv.innerHTML = tema.descricao;
                temasDiv.appendChild(temaDiv);

                const perguntasDoTema = perguntas.filter(function(pergunta) {
                    return pergunta.tema === tema.tema;
                });

                perguntasDoTema.forEach(function(pergunta, index) {
                    const perguntaDiv = document.createElement("div");
                    const perguntaTitulo = document.createElement("h3");
                    const perguntaTexto = document.createTextNode("Pergunta " + (index + 1) + ": " + pergunta.pergunta);

                    perguntaTitulo.appendChild(perguntaTexto);
                    perguntaDiv.appendChild(perguntaTitulo);

                    const respostaZeroLabel = document.createElement("label");
                    respostaZeroLabel.innerHTML = '<input type="radio" name="resposta' + index + '" value="0"> ZERO';
                    perguntaDiv.appendChild(respostaZeroLabel);

                    const respostaUmLabel = document.createElement("label");
                    respostaUmLabel.innerHTML = '<input type="radio" name="resposta' + index + '" value="1"> UM';
                    perguntaDiv.appendChild(respostaUmLabel);

                    temasDiv.appendChild(perguntaDiv);
                });
            });
        }

        // Função para analisar as respostas
        function avaliarRespostas() {
            const perguntasDivs = document.querySelectorAll("#temas > div:not(:last-child)");
            let acertos = 0;
            let totalPerguntas = 0;

            perguntasDivs.forEach(function(div) {
                const respostas = div.getElementsByTagName("input");

                Array.from(respostas).forEach(function(resposta, index) {
                    const pergunta = div.querySelector("h3").textContent;
                    const respostaCorreta = parseInt(resposta.value);
                    const respostaEscolhida = parseInt(resposta.checked ? resposta.value : -1);

                    totalPerguntas++;

                    if (respostaEscolhida === respostaCorreta) {
                        resposta.parentNode.classList.add("correct");
                        acertos++;
                    } else {
                        resposta.parentNode.classList.add("incorrect");
                    }
                });
            });

            const percentualAcerto = (acertos / totalPerguntas * 100).toFixed(2);
            const mensagem = "Você acertou " + acertos + " de " + totalPerguntas + " (" + percentualAcerto + "%)";
            alert(mensagem);
        }

        // Função para fazer o parsing do CSV
        function parseCSV(csvData) {
            const lines = csvData.split("\n");
            const headers = lines[0].split(";");
            const data = [];

            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(";");
                const obj = {};

                for (let j = 0; j < headers.length; j++) {
                    obj[headers[j]] = values[j];
                }

                data.push(obj);
            }

            return data;
        }

        // Lê os arquivos CSV e chama a função de processamento
        lerArquivoCSV("temas.csv", function(temasData) {
            lerArquivoCSV("perguntas.csv", function(perguntasData) {
                processarDados(temasData, perguntasData);
            });
        });
    </script>
</body>
</html>
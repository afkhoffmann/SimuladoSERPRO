<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Simulado</title>
  <style>
    .question {
      margin-bottom: 20px;
    }
    .theme {
      font-weight: bold;
      font-size: 18px;
      margin-bottom: 10px;
    }
    .answer {
      margin-top: 10px;
    }
    .correct {
      color: green;
      font-weight: bold;
    }
    .incorrect {
      color: red;
      font-weight: bold;
    }
    #result {
      margin-top: 20px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>Simulado</h1>

  <div id="questions"></div>

  <button onclick="submitAnswers()">Enviar</button>

  <div id="result"></div>

  <script>
    // Função para ler o arquivo CSV
    function parseCSV(csv) {
      const lines = csv.split('\n');
      const headers = lines[0].split(';');
      const data = [];

      for (let i = 1; i < lines.length; i++) {
        const values = lines[i].split(';');
        const entry = {};

        for (let j = 0; j < headers.length; j++) {
          entry[headers[j]] = values[j];
        }

        data.push(entry);
      }

      return data;
    }

    // Função para carregar os arquivos CSV
    function loadCSVFiles() {
      fetch('perguntas.csv')
        .then(response => response.text())
        .then(data => {
          const questions = parseCSV(data);
          renderQuestions(questions);
        });

      fetch('temas.csv')
        .then(response => response.text())
        .then(data => {
          const themes = parseCSV(data);
          renderThemes(themes);
        });
    }

    // Função para renderizar as perguntas
    function renderQuestions(questions) {
      const questionsContainer = document.getElementById('questions');

      questions.forEach((question, index) => {
        const questionNumber = index + 1;
        const questionElement = document.createElement('div');
        questionElement.className = 'question';

        const theme = document.createElement('div');
        theme.className = 'theme';
        const themeDescription = getThemeDescription(question.tema);
        theme.textContent = `Tema: ${themeDescription}`;
        questionElement.appendChild(theme);

        const questionText = document.createElement('div');
        questionText.textContent = `Pergunta ${questionNumber}: ${question.pergunta}`;
        questionElement.appendChild(questionText);

        const answer = document.createElement('div');
        answer.className = 'answer';

        const correctLabel = document.createElement('label');
        correctLabel.innerHTML = `<input type="radio" name="answer${index}" value="0"> Certo`;
        answer.appendChild(correctLabel);

        const incorrectLabel = document.createElement('label');
        incorrectLabel.innerHTML = `<input type="radio" name="answer${index}" value="1"> Errado`;
        answer.appendChild(incorrectLabel);

        questionElement.appendChild(answer);
        questionsContainer.appendChild(questionElement);
      });
    }

    // Função para obter a descrição do tema com base no número do tema
    function getThemeDescription(themeNumber) {
      const themes = parseCSV(localStorage.getItem('themes'));
      const theme = themes.find(theme => theme.tema === themeNumber);
      return theme ? theme.descricao : '';
    }

    // Função para renderizar os temas
    function renderThemes(themes) {
      const themesData = themes.reduce((acc, theme) => {
        acc[theme.tema] = theme.descricao;
        return acc;
      }, {});

      localStorage.setItem('themes', JSON.stringify(themesData));
    }

    // Função para calcular e exibir os resultados
    function submitAnswers() {
      const questions = document.getElementsByClassName('question');
      const resultElement = document.getElementById('result');
      let total = 0;
      let correct = 0;

      for (let i = 0; i < questions.length; i++) {
        const selectedAnswer = document.querySelector(`input[name="answer${i}"]:checked`);
        const answer = parseInt(selectedAnswer.value);
        const question = questions[i];
        const answerElement = question.getElementsByClassName('answer')[0];

        if (answer === 0) {
          answerElement.classList.add('correct');
          correct++;
        } else {
          answerElement.classList.add('incorrect');
        }

        total++;
      }

      const percentage = (correct / total) * 100;
      resultElement.textContent = `Você acertou ${correct} de ${total} (${percentage.toFixed(2)}%)`;
    }

    // Carregar os arquivos CSV e iniciar a aplicação
    loadCSVFiles();
  </script>
</body>
</html>
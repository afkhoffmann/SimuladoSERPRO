<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Simulado</title>
  <style>
    .question {
      margin-bottom: 10px;
    }

    .correct {
      color: green;
    }

    .incorrect {
      color: red;
    }
  </style>
</head>
<body>
  <h1>Simulado</h1>

  <div id="themes-container"></div>

  <button onclick="checkAnswers()">Enviar</button>
  <p id="result-message"></p>

  <script>
    // Função para ler o arquivo CSV
    function readCSVFile(file, delimiter) {
      return new Promise((resolve, reject) => {
        const xhr = new XMLHttpRequest();
        xhr.open('GET', file, true);
        xhr.onreadystatechange = () => {
          if (xhr.readyState === 4 && xhr.status === 200) {
            const contents = xhr.responseText;
            const lines = contents.split('\n');
            const data = lines.map(line => line.split(delimiter));
            resolve(data);
          }
        };
        xhr.onerror = () => {
          reject(xhr.statusText);
        };
        xhr.send();
      });
    }

    // Função para exibir as perguntas na página
    function displayQuestions(questions) {
      const container = document.getElementById('themes-container');
      container.innerHTML = '';

      questions.forEach((question, index) => {
        const div = document.createElement('div');
        div.classList.add('question');

        const questionTitle = document.createElement('h3');
        questionTitle.textContent = `Pergunta ${index + 1}`;
        div.appendChild(questionTitle);

        const questionText = document.createElement('p');
        questionText.textContent = question[1];
        div.appendChild(questionText);

        const option1 = document.createElement('input');
        option1.type = 'radio';
        option1.name = `question-${index}`;
        option1.value = '0';
        const option1Label = document.createElement('label');
        option1Label.textContent = 'ZERO';
        div.appendChild(option1);
        div.appendChild(option1Label);

        const option2 = document.createElement('input');
        option2.type = 'radio';
        option2.name = `question-${index}`;
        option2.value = '1';
        const option2Label = document.createElement('label');
        option2Label.textContent = 'UM';
        div.appendChild(option2);
        div.appendChild(option2Label);

        container.appendChild(div);
      });
    }

    // Função para verificar as respostas e exibir o resultado
    function checkAnswers() {
      const questions = document.getElementsByClassName('question');
      let correctCount = 0;

      for (let i = 0; i < questions.length; i++) {
        const question = questions[i];
        const selectedOption = question.querySelector('input[type="radio"]:checked');

        if (selectedOption !== null) {
          const questionIndex = parseInt(selectedOption.name.split('-')[1]);
          const answer = parseInt(selectedOption.value);
          const correctAnswer = parseInt(question.getAttribute('data-answer'));

          if (answer === correctAnswer) {
            selectedOption.parentNode.classList.add('correct');
            correctCount++;
          } else {
            selectedOption.parentNode.classList.add('incorrect');
          }
        }
      }

      const resultMessage = document.getElementById('result-message');
      const percentage = (correctCount / questions.length) * 100;
      resultMessage.textContent = `Você acertou ${correctCount} de ${questions.length} (${percentage.toFixed(2)}%)`;
    }

    // Função principal para carregar os dados e iniciar a aplicação
    function loadApplication() {
      const promises = [
        readCSVFile('perguntas.csv', ';'),
        readCSVFile('temas.csv', ';')
      ];

      Promise.all(promises)
        .then(([questionsData, themesData]) => {
          const themesMap = new Map();

          themesData.forEach(theme => {
            const [themeId, description] = theme;
            themesMap.set(themeId, description);
          });

          const questionsByTheme = new Map();

          // Ignorar a primeira linha (cabeçalho) do arquivo "perguntas.csv"
          questionsData.shift();

          questionsData.forEach(question => {
            const [themeId, questionText, answer] = question;

            if (!questionsByTheme.has(themeId)) {
              questionsByTheme.set(themeId, []);
            }

            questionsByTheme.get(themeId).push([themeId, questionText, parseInt(answer)]);
          });

          const themesContainer = document.getElementById('themes-container');

          for (const [themeId, questions] of questionsByTheme) {
            const themeDescription = themesMap.get(themeId);

            const themeDiv = document.createElement('div');
            themeDiv.textContent = themeDescription;
            themesContainer.appendChild(themeDiv);

            questions.forEach(question => {
              questionDiv = document.createElement('div');
              questionDiv.setAttribute('data-answer', question[2]);

              const questionText = document.createElement('p');
              questionText.textContent = question[1];
              questionDiv.appendChild(questionText);

              themesContainer.appendChild(questionDiv);
            });
          }

          displayQuestions(questionsData);
        })
        .catch(error => {
          console.error('Error reading CSV file:', error);
        });
    }

  document.addEventListener('DOMContentLoaded', loadApplication);
  </script>
</body>
</html>